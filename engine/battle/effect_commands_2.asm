INCLUDE "engine/battle/move_effects/far_command_index.asm"
INCLUDE "engine/battle/move_effects/conditional_boost.asm"
INCLUDE "engine/battle/move_effects/status_target_self.asm"
INCLUDE "engine/battle/move_effects/status_target_opponent.asm"
INCLUDE "engine/battle/move_effects/multi_stat_down.asm"
INCLUDE "engine/battle/move_effects/protect_variations.asm"
INCLUDE "engine/battle/move_effects/variable_type.asm"
INCLUDE "engine/battle/move_effects/readying_moves.asm"
INCLUDE "engine/battle/move_effects/constant_damage.asm"

INCLUDE "engine/battle/move_effects/false_swipe.asm"
INCLUDE "engine/battle/move_effects/leech_seed.asm"
INCLUDE "engine/battle/move_effects/spite.asm"
INCLUDE "engine/battle/move_effects/safeguard.asm"
INCLUDE "engine/battle/move_effects/selfdestruct.asm"
INCLUDE "engine/battle/move_effects/thief.asm"
INCLUDE "engine/battle/move_effects/heal_bell.asm"
INCLUDE "engine/battle/move_effects/pain_split.asm"
INCLUDE "engine/battle/move_effects/spikes.asm"
INCLUDE "engine/battle/move_effects/focus_energy.asm"
INCLUDE "engine/battle/move_effects/counter.asm"
INCLUDE "engine/battle/move_effects/arena_trap.asm"
INCLUDE "engine/battle/move_effects/rapid_spin.asm"
INCLUDE "engine/battle/move_effects/foresight.asm"
INCLUDE "engine/battle/move_effects/fury_cutter.asm"
INCLUDE "engine/battle/move_effects/attract.asm"
INCLUDE "engine/battle/move_effects/magnitude.asm"
INCLUDE "engine/battle/move_effects/rain_dance.asm"
INCLUDE "engine/battle/move_effects/sunny_day.asm"
INCLUDE "engine/battle/move_effects/sandstorm.asm"
INCLUDE "engine/battle/move_effects/heal_weather.asm"
INCLUDE "engine/battle/move_effects/mist.asm"
INCLUDE "engine/battle/move_effects/screens.asm"
INCLUDE "engine/battle/move_effects/substitute.asm"
INCLUDE "engine/battle/move_effects/destiny_bond.asm"
INCLUDE "engine/battle/move_effects/curse.asm"
INCLUDE "engine/battle/move_effects/perish_song.asm"
INCLUDE "engine/battle/move_effects/belly_drum.asm"
INCLUDE "engine/battle/move_effects/psych_up.asm"
INCLUDE "engine/battle/move_effects/conversion.asm"
INCLUDE "engine/battle/move_effects/nightmare.asm"
INCLUDE "engine/battle/move_effects/lock_on.asm"
INCLUDE "engine/battle/move_effects/disable.asm"
INCLUDE "engine/battle/move_effects/pay_day.asm"
INCLUDE "engine/battle/move_effects/return.asm"
INCLUDE "engine/battle/move_effects/frustration.asm"

INCLUDE "engine/battle/move_effects/cut.asm"
INCLUDE "engine/battle/move_effects/shell_smash.asm"
INCLUDE "engine/battle/move_effects/bug_bite.asm"
INCLUDE "engine/battle/move_effects/quiver_dance.asm"
INCLUDE "engine/battle/move_effects/venoshock.asm"
INCLUDE "engine/battle/move_effects/sucker_punch.asm"
INCLUDE "engine/battle/move_effects/hail.asm"
INCLUDE "engine/battle/move_effects/round.asm"
INCLUDE "engine/battle/move_effects/burn_up.asm"
INCLUDE "engine/battle/move_effects/knock_off.asm"
INCLUDE "engine/battle/move_effects/reflect_type.asm"
INCLUDE "engine/battle/move_effects/brine.asm"
INCLUDE "engine/battle/move_effects/payback.asm"
INCLUDE "engine/battle/move_effects/move_first_boost.asm"
INCLUDE "engine/battle/move_effects/smelling_salts_wake_up_slap.asm"
INCLUDE "engine/battle/move_effects/trick.asm"
INCLUDE "engine/battle/move_effects/reset_stats_target.asm"
INCLUDE "engine/battle/move_effects/misty_terrain.asm"
INCLUDE "engine/battle/move_effects/defog.asm"
INCLUDE "engine/battle/move_effects/hex.asm"
INCLUDE "engine/battle/move_effects/freeze_dry.asm"
INCLUDE "engine/battle/move_effects/psycho_shift.asm"
INCLUDE "engine/battle/move_effects/roost.asm"
INCLUDE "engine/battle/move_effects/brick_break.asm"
INCLUDE "engine/battle/move_effects/trap_hit.asm"
INCLUDE "engine/battle/move_effects/dynamo_rush.asm"
; INCLUDE "engine/battle/move_effects/bright_moss.asm"
INCLUDE "engine/battle/move_effects/ingrain.asm"
INCLUDE "engine/battle/move_effects/uproot.asm"
INCLUDE "engine/battle/move_effects/coil.asm"
INCLUDE "engine/battle/move_effects/uproar.asm"
INCLUDE "engine/battle/move_effects/acrobatics.asm"
INCLUDE "engine/battle/move_effects/soak.asm"
INCLUDE "engine/battle/move_effects/weather_ball.asm"
INCLUDE "engine/battle/move_effects/captivate.asm"
INCLUDE "engine/battle/move_effects/acupressure.asm"
INCLUDE "engine/battle/move_effects/charge.asm"
INCLUDE "engine/battle/move_effects/yawn.asm"
INCLUDE "engine/battle/move_effects/crafty_shield.asm"
INCLUDE "engine/battle/move_effects/lucky_chant.asm"
INCLUDE "engine/battle/move_effects/aqua_ring.asm"
INCLUDE "engine/battle/move_effects/grudge.asm"
INCLUDE "engine/battle/move_effects/trick_room.asm"
INCLUDE "engine/battle/move_effects/retaliate.asm"
INCLUDE "engine/battle/move_effects/facade.asm"
INCLUDE "engine/battle/move_effects/magnet_rise.asm"
INCLUDE "engine/battle/move_effects/healing_wish.asm"
INCLUDE "engine/battle/move_effects/heavy_slam.asm"
INCLUDE "engine/battle/move_effects/refresh.asm"
INCLUDE "engine/battle/move_effects/stockpile.asm"
INCLUDE "engine/battle/move_effects/defrost_awaken.asm"
INCLUDE "engine/battle/move_effects/weathervane.asm"
INCLUDE "engine/battle/move_effects/cultivate.asm"
INCLUDE "engine/battle/move_effects/split_stats.asm"
INCLUDE "engine/battle/move_effects/laser_focus.asm"
INCLUDE "engine/battle/move_effects/powder.asm"
INCLUDE "engine/battle/move_effects/wish.asm"
INCLUDE "engine/battle/move_effects/topsy_turvy.asm"
INCLUDE "engine/battle/move_effects/electrify.asm"
; INCLUDE "engine/battle/move_effects/geomancy.asm"
INCLUDE "engine/battle/move_effects/power_trick.asm"
INCLUDE "engine/battle/move_effects/revenge.asm"
; INCLUDE "engine/battle/move_effects/clangorous_soul.asm"
INCLUDE "engine/battle/move_effects/speed_swap.asm"
INCLUDE "engine/battle/move_effects/stat_swap.asm"
; INCLUDE "engine/battle/move_effects/tar_shot.asm"
INCLUDE "engine/battle/move_effects/octolock.asm"
INCLUDE "engine/battle/move_effects/teatime.asm"
; INCLUDE "engine/battle/move_effects/bolt_beak.asm"
INCLUDE "engine/battle/move_effects/poltergeist.asm"
INCLUDE "engine/battle/move_effects/trump_card.asm"
INCLUDE "engine/battle/move_effects/stat_up_3.asm"
INCLUDE "engine/battle/move_effects/electro_ball.asm"
INCLUDE "engine/battle/move_effects/gyro_ball.asm"
INCLUDE "engine/battle/move_effects/purify.asm"
INCLUDE "engine/battle/move_effects/eerie_spell.asm"
INCLUDE "engine/battle/move_effects/stone_axe.asm"

CheckSafeguardEffect:
; checksafeguard
	ld hl, wEnemyScreens
	ldh a, [hBattleTurn]
	and a
	jr z, .got_turn
	ld hl, wPlayerScreens
.got_turn
	bit SCREENS_SAFEGUARD, [hl]
	ret z
	ld a, 1
	ld [wAttackMissed], a
	farcall BattleCommand_MoveDelay
	ld hl, SafeguardProtectText
	call StdBattleTextbox
	farcall EndMoveEffect
	ret

DoSubstituteDamage:
	ld hl, SubTookDamageText
	call StdBattleTextbox

	ld de, wEnemySubstituteHP
	ldh a, [hBattleTurn]
	and a
	jr z, .got_hp
	ld de, wPlayerSubstituteHP
.got_hp

	ld hl, wCurDamage
	ld a, [hli]
	and a
	jr nz, .broke

	ld a, [de]
	sub [hl]
	ld [de], a
	jr z, .broke
	jr nc, .done

.broke
	ld a, BATTLE_VARS_SUBSTATUS4_OPP
	call GetBattleVarAddr
	res SUBSTATUS_SUBSTITUTE, [hl]

	ld hl, SubFadedText
	call StdBattleTextbox

	farcall BattleCommand_SwitchTurn
	farcall BattleCommand_LowerSubNoAnim
	ld a, BATTLE_VARS_SUBSTATUS3
	call GetBattleVar
	and 1 << SUBSTATUS_FLYING | 1 << SUBSTATUS_UNDERGROUND | 1 << SUBSTATUS_DIVING | 1 << SUBSTATUS_VANISHED
	call z, .appear_user_lower_sub
	farcall BattleCommand_SwitchTurn

	ld a, BATTLE_VARS_MOVE_EFFECT
	call GetBattleVarAddr
	cp EFFECT_MULTI_HIT
	jr z, .ok
	cp EFFECT_DOUBLE_HIT
	jr z, .ok
	cp EFFECT_POISON_MULTI_HIT
	jr z, .ok
	cp EFFECT_PRIORITY_MULTI_HIT
	jr z, .ok
	cp EFFECT_SCALE_SHOT
	jr z, .ok
	cp EFFECT_TRIPLE_KICK
	jr z, .ok
	cp EFFECT_BEAT_UP
	jr z, .ok
	xor a
	ld [hl], a
.ok
	farcall RefreshBattleHuds
.done
	jp ResetDamage

.appear_user_lower_sub
	farcall _AppearUserLowerSub
	ret
